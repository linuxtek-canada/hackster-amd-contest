
git clone https://github.com/cryptk/LocalAI.git
cd LocalAI
git checkout feat_updated_smaller_rocm
git pull

docker build \
  --build-arg BUILD_TYPE="hipblas" \
  --build-arg GRPC_MAKEFLAGS="-j8 -Otarget" \
  --build-arg MAKEFLAGS="-j8 -Otarget" \
  --build-arg=BASE_IMAGE=rocm/dev-ubuntu-22.04:6.1 \
  --build-arg=GRPC_BASE_IMAGE=ubuntu:22.04 \
  --build-arg=FFMPEG=true \
  -t pr2196 .

cd <local testing folder>
docker compose -f ./pr2196test.yaml up

# Run manually 
docker run -it --entrypoint /bin/bash localai/localai:latest-aio-gpu-hipblas

=====

mkdir --parents --mode=0755 /etc/apt/keyrings

wget https://repo.radeon.com/rocm/rocm.gpg.key -O - | \
    gpg --dearmor | tee /etc/apt/keyrings/rocm.gpg > /dev/null


echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/rocm.gpg] https://repo.radeon.com/amdgpu/6.1/ubuntu jammy main" \
    | tee /etc/apt/sources.list.d/amdgpu.list
apt update

echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/rocm.gpg] https://repo.radeon.com/rocm/apt/6.1 jammy main" \
    | tee --append /etc/apt/sources.list.d/rocm.list
echo -e 'Package: *\nPin: release o=repo.radeon.com\nPin-Priority: 600' \
    | tee /etc/apt/preferences.d/rocm-pin-600
sudo apt update

==========================

# Download and Extract Deb file
apt-get update
apt-get download hipblas-dev
ar vx hipblas-dev_2.1.0.60100-82~22.04_amd64.deb
mkdir control && tar -xvf control.tar.gz -C control
ls -al ./control

apt-get download libc6
ar vx libc6_2.35-0ubuntu3.7_amd64.deb
mkdir control && tar -I zstd -xvf control.tar.zst -C control
ls -al  ./control


# Triggers added by dh_makeshlibs/13.6ubuntu1
activate-noawait ldconfig

==================================

curl http://localhost:8080/v1/chat/completions \
    -H "Content-Type: application/json" \
    -d '{ "model": "gpt-4", "messages": [{"role": "user", "content": "What is the current weather in Toronto, Ontario, Canada?", "temperature": 0.1}] }'


curl -X POST \
  http://localhost:8000/v1/chat/completions \
  -H 'Content-Type: application/json' \
  -d '{
    "model": "text-davinci-003",
    "prompt": "What is the current weather in Toronto, Ontario, Canada in Celcius?",
    "max_tokens": 50
  }'

curl http://localhost:8080/v1/audio/transcriptions \
    -H "Content-Type: multipart/form-data" \
    -F file="@$PWD/gb1.ogg" -F model="whisper-1"


# ./local-ai > /tmp/localai.log 2>&1

curl http://localhost:8080/v1/chat/completions \
    -H "Content-Type: application/json" \
    -d '{ "model": "mixtral-instruct", "messages": [{"role": "user", "content": "How are you doing?", "temperature": 0.1}] }'


curl http://localhost:8080/v1/images/generations \
    -H "Content-Type: application/json" -d '{
        "prompt": "The word IMAGINE written on background with colorful rainbow thin streams and glowing sparkling particles. Color explosion circle banner",
        "size": "1024x1024"
      }'

    s